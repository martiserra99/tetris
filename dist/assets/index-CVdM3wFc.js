(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();const N=window.devicePixelRatio||1;class te{constructor(e){this.started=!1,this.animationId=null,this.mouseSignals=[],this.keySignals=[],this.element=null,this.setCanvas(e),this.setCanvasSize(),this.setCanvasSizeOnResize()}setCanvas(e){this.canvas=typeof e=="string"?document.querySelector(e):e,this.ctx=this.canvas.getContext("2d")}setCanvasSize(){const{width:e,height:t}=this.canvas.getBoundingClientRect();this.width=e,this.height=t,this.canvas.width=e*N,this.canvas.height=t*N,this.ctx.scale(N,N)}setCanvasSizeOnResize(){this.resizeListener=this.setCanvasSize.bind(this),window.addEventListener("resize",this.resizeListener)}start(e){this.started&&this.end(),this.insertElement(e),this.startAnimation(),this.setupSignals(),this.started=!0}insertElement(e){e.insertToUI(this)}startAnimation(){const e=()=>{this.animationId=requestAnimationFrame(e),this.updateUI()};e()}updateUI(){this.clearCanvas(),this.element.start(),this.element.measure(this.getMaxSize()),this.element.locate(this.getCoords()),this.element.draw(this.ctx),this.element.end()}getMaxSize(){return{width:this.width,height:this.height}}getCoords(){return{x:0,y:0}}setupSignals(){this.setupMouseSignals(),this.setupKeySignals()}setupMouseSignals(){const e=this.getMouseSignalTypes();for(const t of e){const i=s=>{const o=this.getMouseSignalData(s);this.element.signal({type:t,data:o})};this.mouseSignals.push({type:t,callback:i}),this.canvas.addEventListener(t,i)}}getMouseSignalTypes(){return["mousedown","mouseup","mousemove","mouseenter","mouseleave"]}getMouseSignalData(e){return{x:e.offsetX,y:e.offsetY}}setupKeySignals(){const e=this.getKeySignalTypes();for(const t of e){const i=s=>{if(s.repeat)return;const o=this.getKeySignalData(s);this.element.signal({type:t,data:o})};this.keySignals.push({type:t,callback:i}),window.addEventListener(t,i)}}getKeySignalTypes(){return["keydown","keyup"]}getKeySignalData(e){return e.key}end(){this.started&&(this.removeSignals(),this.stopAnimation(),this.removeElement(),this.started=!1)}removeSignals(){this.removeMouseSignals(),this.removeKeySignals()}removeMouseSignals(){for(const{type:e,callback:t}of this.mouseSignals)this.canvas.removeEventListener(e,t);this.mouseSignals=[]}removeKeySignals(){for(const{type:e,callback:t}of this.keySignals)window.removeEventListener(e,t);this.keySignals=[]}stopAnimation(){cancelAnimationFrame(this.animationId),this.animationId=null,this.clearCanvas()}removeElement(){this.element=null}clearCanvas(){const e=this.getCoords(),t=this.getMaxSize();this.ctx.clearRect(e.x,e.y,t.width,t.height)}}let ne=class{constructor(){this.events=new Map,this.add()}[Symbol.iterator](){return this.events[Symbol.iterator]()}set(n,e){this.events.set(n,{check:e,callbacks:[]})}get(n){return this.events.get(n)}add(){this.click(),this.mousedown(),this.mouseup(),this.mouseenter(),this.mouseleave(),this.mousemove(),this.keydown(),this.keyup()}click(){this.set("click",(function(n,e,t){if(e.type!=="mousedown"&&e.type!=="mouseup")return{event:!1};const i=R(e.data,n);if(e.type==="mousedown")return t.set("wasMouseDown",i),{event:!1};const s=t.get("wasMouseDown",!1);return{event:i&&s,data:e.data}}))}mousedown(){this.set("mousedown",(function(n,e){return e.type!=="mousedown"?{event:!1}:R(e.data,n)?{event:!0,data:e.data}:{event:!1}}))}mouseup(){this.set("mouseup",(function(n,e){return e.type!=="mouseup"?{event:!1}:R(e.data,n)?{event:!0,data:e.data}:{event:!1}}))}mouseenter(){this.set("mouseenter",(function(n,e,t){if(e.type==="mouseleave"&&t.set("wasOut",!0),e.type!=="mousemove")return{event:!1};const i=R(e.data,n),s=t.get("wasOut",!0),o=i&&s;return t.set("wasOut",!i),{event:o,data:e.data}}))}mouseleave(){this.set("mouseleave",(function(n,e,t){if(e.type==="mouseleave")return t.set("wasIn",!1),{event:!0,data:e.data};if(e.type!=="mousemove")return{event:!1};const i=!R(e.data,n),s=t.get("wasIn",!1),o=i&&s;return t.set("wasIn",!i),{event:o,data:e.data}}))}mousemove(){this.set("mousemove",(function(n,e){return e.type!=="mousemove"?{event:!1}:R(e.data,n)?{event:!0,data:e.data}:{event:!1}}))}keydown(){this.set("keydown",(function(n,e){return e.type!=="keydown"?{event:!1}:{event:!0,data:e.data}}))}keyup(){this.set("keyup",(function(n,e){return e.type!=="keyup"?{event:!1}:{event:!0,data:e.data}}))}};function R(n,e){return n.x>=e.coords.x&&n.y>=e.coords.y&&n.x<=e.coords.x+e.size.width&&n.y<=e.coords.y+e.size.height}let ie=class{constructor(){this.properties=new Map,this.functions=new Map}set(n,e){this.properties.set(n,e)}get(n){return this.properties.get(n)}fun(n,e){this.functions.set(n,e)}call(n,...e){return this.functions.get(n)(...e)}};class O{constructor(e){this.name=e,this.properties=new Map,this.functions=new Map,this.lifecycle=this.getLifecycle(),this.inner=new ie,this.events=new ne}getLifecycle(){return new _}set(e,t){this.properties.set(e,t)}fun(e,t){this.functions.set(e,t)}}class _{constructor(){this.lifecycle=new Map,this.setFunctions()}setFunctions(){this.lifecycle.set("onCreate",(()=>{})),this.lifecycle.set("onStart",(()=>{})),this.lifecycle.set("onMeasure",(()=>{})),this.lifecycle.set("onLocate",(()=>{})),this.lifecycle.set("onDraw",(()=>{})),this.lifecycle.set("onEnd",(()=>{}))}[Symbol.iterator](){return this.lifecycle[Symbol.iterator]()}set(e,t){this.lifecycle.has(e)&&this.lifecycle.set(e,t)}}class se extends O{getLifecycle(){return new oe}}class oe extends _{setFunctions(){super.setFunctions(),this.lifecycle.set("getSize",(()=>({width:0,height:0}))),this.lifecycle.set("drawItself",(()=>{}))}}class re extends O{constructor(e){super(e),this.layoutParams=new ae}getLifecycle(){return new le}}class le extends _{setFunctions(){super.setFunctions(),this.lifecycle.set("sortChildrenToMeasure",(e=>e.children)),this.lifecycle.set("getChildMaxSize",(()=>({width:0,height:0}))),this.lifecycle.set("getSize",(()=>({width:0,height:0}))),this.lifecycle.set("sortChildrenToLocate",(e=>e.children)),this.lifecycle.set("getChildCoords",((e,t)=>t)),this.lifecycle.set("drawItself",(()=>{})),this.lifecycle.set("sortChildrenToDraw",(e=>e.children))}}let ae=class{constructor(){this.layoutParams=new Map}[Symbol.iterator](){return this.layoutParams[Symbol.iterator]()}set(n,e){this.layoutParams.set(n,e)}};class ce extends O{getLifecycle(){return new ue}}class ue extends _{setFunctions(){super.setFunctions(),this.lifecycle.set("getElement",(()=>{})),this.lifecycle.set("updateElement",(()=>{}))}}function U(n){return JSON.parse(JSON.stringify(n))}function J(n,e){const t=n.findIndex((i=>i===e));return t!==-1&&(n.splice(t,1),!0)}class de{constructor(e,t){this.element=e,this.properties=new Map,this.functions=new Map,this.setProperties(t.properties),this.setFunctions(t.functions)}setProperties(e){for(const[t,i]of e)this.properties.set(t,U(i))}setFunctions(e){for(const[t,i]of e)this.functions.set(t,i.bind(this.element,this.element))}set(e,t){this.properties.set(e,t)}get(e){return this.properties.get(e)}fun(e,t){this.functions.set(e,t.bind(this.element,this.element))}call(e,...t){return this.functions.get(e)(...t)}}class he{constructor(e){this.element=e,this.properties=new Map,this.functions=new Map}set(e,t){this.properties.set(e,t)}get(e){return this.properties.get(e)}fun(e,t){this.functions.set(e,t.bind(this.element,this.element))}call(e,...t){return this.functions.get(e)(...t)}}class ge{constructor(e){this.events=new Map,this.setEvents(e)}setEvents(e){for(const[t,{check:i,callbacks:s}]of e)this.events.set(t,{check:i,state:new fe,callbacks:[...s]})}[Symbol.iterator](){return this.events[Symbol.iterator]()}get(e){return this.events.get(e)}}class fe{constructor(){this.keys=new Map}set(e,t){this.keys.set(e,t)}get(e,t){return this.has(e)?this.keys.get(e):t}del(e){this.keys.delete(e)}has(e){return this.keys.has(e)}}class me{constructor(e){this.events=e}add(e,t){this.events.get(e).callbacks.push(t)}remove(e,t){return J(this.events.get(e).callbacks,t)}removeAll(e){const t=this.events.get(e).callbacks;t.splice(0,t.length)}}class ye{constructor(e){this.layoutParent=e.layoutParent,this.layoutParams=new Map,this.setLayoutParams()}setLayoutParams(){for(const[e,t]of this.layoutParent.childLayoutParams)this.layoutParams.set(e,U(t))}set(e,t){this.layoutParams.has(e)&&this.layoutParams.set(e,t)}get(e){return this.layoutParams.get(e)}}class W{get layoutParams(){return this.layoutParameters}constructor(e,t){this.id=e,this.size={width:0,height:0},this.coords={x:0,y:0},this.properties=new Map,this.functions=new Map,this.lifecycle=new Map,this.setProperties(t.properties),this.setFunctions(t.functions),this.setLifecycle(t.lifecycle),this.inner=new de(this,t.inner),this.custom=new he(this),this.events=new ge(t.events),this.listeners=new me(this.events),this.lifecycle.get("onCreate")()}setProperties(e){for(const[t,i]of e)this.properties.set(t,U(i))}setFunctions(e){for(const[t,i]of e)this.functions.set(t,i.bind(this,this))}setLifecycle(e){for(const[t,i]of e)this.lifecycle.set(t,i.bind(this,this))}set(e,t){this.properties.has(e)&&this.properties.set(e,t)}get(e){return this.properties.get(e)}fun(e,t){this.functions.set(e,t.bind(this,this))}call(e,...t){return this.functions.get(e)(...t)}insertToUI(e){this.removeFromUI(),this.removeFromLayout(),e.element=this,this.uiParent=e}removeFromUI(){this.uiParent&&(this.uiParent.element=null),delete this.uiParent,this.resetPlacementData()}insertToLayout(e){this.removeFromUI(),this.removeFromLayout(),e.children.push(this),this.layoutParent=e,this.layoutParameters=new ye(this)}removeFromLayout(){this.layoutParent&&J(this.layoutParent.children,this),delete this.layoutParent,delete this.layoutParameters,this.resetPlacementData()}resetPlacementData(){this.size={width:0,height:0},this.coords={x:0,y:0}}start(){this.lifecycle.get("onStart")()}measure(e){this.lifecycle.get("onMeasure")(e)}locate(e){this.lifecycle.get("onLocate")(e)}draw(e){this.lifecycle.get("onDraw")(e)}end(){this.lifecycle.get("onEnd")()}signal(e){for(const[,{check:t,state:i,callbacks:s}]of this.events){const{event:o,data:r}=t(this,e,i);if(o)for(const l of s)l(this,r)}}}let pe=class extends W{constructor(e,t){super(e,t)}measure(e){super.measure(e),this.setSize(e)}setSize(e){this.size=this.lifecycle.get("getSize")(e)}locate(e){super.locate(e),this.setCoords(e)}setCoords(e){this.coords=e}draw(e){super.draw(e),this.drawItself(e)}drawItself(e){this.lifecycle.get("drawItself")(e)}};class X extends W{constructor(e,t){super(e,t),this.children=[],this.childLayoutParams=new Map,this.setChildLayoutParams(t)}setChildLayoutParams(e){for(const[t,i]of e.layoutParams)this.childLayoutParams.set(t,i)}start(){super.start();for(const e of this.children)e.start()}measure(e){super.measure(e),this.setChildrenSizes(e),this.setSize(e)}setChildrenSizes(e){const t=this.sortChildrenToMeasure(e),i=[];for(const s of t){const o=this.getChildMaxSize(e,s,i);s.measure(o),i.push(s)}}sortChildrenToMeasure(e){return this.lifecycle.get("sortChildrenToMeasure")(e)}getChildMaxSize(e,t,i){return this.lifecycle.get("getChildMaxSize")(e,t,i)}setSize(e){this.size=this.lifecycle.get("getSize")(e)}locate(e){super.locate(e),this.setChildrenCoords(e),this.setCoords(e)}setChildrenCoords(e){const t=this.sortChildrenToLocate(e),i=[];for(const s of t){const o=this.getChildCoords(e,s,i);s.locate(o),i.push(s)}}sortChildrenToLocate(e){return this.lifecycle.get("sortChildrenToLocate")(e)}getChildCoords(e,t,i){return this.lifecycle.get("getChildCoords")(e,t,i)}setCoords(e){this.coords=e}draw(e){super.draw(e),this.drawItself(e),this.drawChildren(e)}drawItself(e){this.lifecycle.get("drawItself")(e)}drawChildren(e){const t=this.sortChildrenToDraw(e);for(const i of t)i.draw(e)}sortChildrenToDraw(e){return this.lifecycle.get("sortChildrenToDraw")(e)}end(){super.end();for(const e of this.children)e.end()}signal(e){super.signal(e);for(const t of this.children)t.signal(e)}insert(e){e.insertToLayout(this)}remove(e){this.children.includes(e)&&e.removeFromLayout()}removeAll(){for(const e of[...this.children])e.removeFromLayout()}find(e,t=!1){const i=[...this.children];for(;i.length>0;){const s=i.shift();if(s.id===e)return s;s instanceof X&&!t&&i.push(...s.children)}return null}}class we extends W{constructor(e,t){super(e,t),this.child=this.lifecycle.get("getElement")()}start(){super.start(),this.lifecycle.get("updateElement")(this.child),this.child.start()}measure(e){super.measure(e),this.child.measure(e),this.size=this.child.size}locate(e){super.locate(e),this.child.locate(e),this.coords=e}draw(e){super.draw(e),this.child.draw(e)}end(){super.end(),this.child.end()}signal(e){super.signal(e),this.child.signal(e)}}const v={length(n,e,t=()=>0){let i=n===null?t():n;return i>e&&(i=e),i<0&&(i=0),i},availableLength:(n,e)=>n===null?e:n<e?n:e,desiredLength(n,e){if(n==="auto")return null;const{unit:t,value:i}=n;return t==="px"?i:e*(i/100)},size(n,e,t={width:()=>0,height:()=>0}){return{width:this.length(n.width,e.width,t.width),height:this.length(n.height,e.height,t.height)}},availableSize(n,e){return{width:this.availableLength(n.width,e.width),height:this.availableLength(n.height,e.height)}},desiredSize(n,e){return{width:this.desiredLength(n.width,e.width),height:this.desiredLength(n.height,e.height)}},textSize(n,e){const t=document.createElement("canvas").getContext("2d");return t.font=`${e.weight} ${e.size}px ${e.family}`,{width:t.measureText(n).width,height:e.size}}},T={area(n,e,t,i,s,o){const r={x:e.x+s.size/2,y:e.y+s.size/2},l=t.width-s.size,a=t.height-s.size,c={width:l,height:a};let u=o.size;o.size>l/2&&(u=l/2),o.size>a/2&&(u=a/2),u<0&&(u=0);const f={type:o.type,size:u};n.save(),n.beginPath(),n.fillStyle=i,n.strokeStyle=s.color,n.lineWidth=s.size,this._areaPath(n,r,c,f),n.fill(),s.size>0&&n.stroke(),n.restore()},_areaPath(n,e,t,i){n.moveTo(e.x,e.y+t.height-i.size),this._leftEdgePath(n,e,i),this._topLeftCornerPath(n,e,i),this._topEdgePath(n,e,t,i),this._topRightCornerPath(n,e,t,i),this._rightEdgePath(n,e,t,i),this._bottomRightCornerPath(n,e,t,i),this._bottomEdgePath(n,e,t,i),this._bottomLeftCornerPath(n,e,t,i),n.closePath()},_leftEdgePath(n,e,t){n.lineTo(e.x,e.y+t.size)},_topLeftCornerPath(n,e,t){const i={x:e.x,y:e.y+t.size},s={x:e.x+t.size,y:e.y};t.type==="round"?n.arcTo(i.x,i.y-t.size,s.x,s.y,t.size):n.lineTo(s.x,s.y)},_topEdgePath(n,e,t,i){n.lineTo(e.x+t.width-i.size,e.y)},_topRightCornerPath(n,e,t,i){const s={x:e.x+t.width-i.size,y:e.y},o={x:e.x+t.width,y:e.y+i.size};i.type==="round"?n.arcTo(s.x+i.size,s.y,o.x,o.y,i.size):n.lineTo(o.x,o.y)},_rightEdgePath(n,e,t,i){n.lineTo(e.x+t.width,e.y+t.height-i.size)},_bottomRightCornerPath(n,e,t,i){const s={x:e.x+t.width,y:e.y+t.height-i.size},o={x:e.x+t.width-i.size,y:e.y+t.height};i.type==="round"?n.arcTo(s.x,s.y+i.size,o.x,o.y,i.size):n.lineTo(o.x,o.y)},_bottomEdgePath(n,e,t,i){n.lineTo(e.x+i.size,e.y+t.height)},_bottomLeftCornerPath(n,e,t,i){const s={x:e.x+i.size,y:e.y+t.height},o={x:e.x,y:e.y+t.height-i.size};i.type==="round"?n.arcTo(s.x-i.size,s.y,o.x,o.y,i.size):n.lineTo(o.x,o.y)},rectangle(n,e,t,i){const{x:s,y:o}=e,{width:r,height:l}=t;n.save(),n.fillStyle=i,n.fillRect(s,o,r,l),n.restore()},text(n,e,t,i,s,o,r){n.save(),n.beginPath(),n.rect(e.x,e.y,t.width,t.height),n.clip(),n.font=`${o.weight} ${o.size}px ${o.family}`,n.fillStyle=r,n.textBaseline="top",n.fillText(s,i.x,i.y),n.restore()},image(n,e,t,i){const{x:s,y:o}=e,{width:r,height:l}=t;n.drawImage(i,s,o,r,l)}},g={alignStart:(n,e,t={start:0,end:0})=>n.start+t.start,alignMiddle:(n,e,t={start:0,end:0})=>n.start+(n.end-n.start)/2-(e+t.start+t.end)/2+t.start,alignEnd:(n,e,t={start:0,end:0})=>n.end-e-t.end};function ze(){(function(){const n=m.view.newType("area");n.set("size",{width:{unit:"px",value:100},height:{unit:"px",value:100}}),n.set("background","#000"),n.set("border",{color:"#000",size:0}),n.set("corner",{type:"cut",size:0}),n.lifecycle.set("getSize",(function(e,t){const i=v.desiredSize(e.get("size"),t);return v.size(i,t)})),n.lifecycle.set("drawItself",(function(e,t){const i=e.coords,s=e.size,o=e.get("background"),r=e.get("border"),l=e.get("corner");T.area(t,i,s,o,r,l)}))})(),(function(){const n=m.view.newType("text");n.set("text","Text"),n.set("font",{size:16,family:"Courier New",weight:400}),n.set("color","#000"),n.set("align",{vertical:"middle",horizontal:"left"}),n.lifecycle.set("onMeasure",(function(e){const t=v.textSize(e.get("text"),e.get("font"));e.inner.set("textSize",t)})),n.lifecycle.set("getSize",(function(e,t){return v.size(e.inner.get("textSize"),t)})),n.lifecycle.set("onLocate",(function(e,t){const i=e.inner.call("getTextCoords",t);e.inner.set("textCoords",i)})),n.inner.fun("getTextCoords",(function(e,t){return{x:e.inner.call("getTextX",t),y:e.inner.call("getTextY",t)}})),n.inner.fun("getTextX",(function(e,t){const i=t.x,s={start:i,end:i+e.size.width},o=e.inner.get("textSize").width,r=e.get("align").horizontal;return r==="left"?g.alignStart(s,o):r==="middle"?g.alignMiddle(s,o):g.alignEnd(s,o)})),n.inner.fun("getTextY",(function(e,t){const i=t.y,s={start:i,end:i+e.size.height},o=e.inner.get("textSize").height,r=e.get("align").vertical;return r==="top"?g.alignStart(s,o):r==="middle"?g.alignMiddle(s,o):g.alignEnd(s,o)})),n.lifecycle.set("drawItself",(function(e,t){T.text(t,e.coords,e.size,e.inner.get("textCoords"),e.get("text"),e.get("font"),e.get("color"))}))})(),(function(){const n=m.view.newType("image");n.set("size",{width:100,height:100}),n.set("src",""),n.inner.set("lastSrc",""),n.lifecycle.set("onCreate",(function(e){e.inner.set("img",new Image)})),n.lifecycle.set("onStart",(function(e){e.get("src")!==e.inner.get("lastSrc")&&(e.inner.get("img").src=e.get("src"))})),n.lifecycle.set("getSize",(function(e,t){return v.size(e.get("size"),t)})),n.lifecycle.set("drawItself",(function(e,t){T.image(t,e.coords,e.size,e.inner.get("img"))})),n.lifecycle.set("onEnd",(function(e){e.inner.set("lastSrc",e.get("src"))}))})()}function be(){const n=m.layout.newType("frame");n.set("size",{width:{unit:"%",value:100},height:{unit:"%",value:100}}),n.set("background","rgba(0,0,0,0)"),n.set("border",{color:"#000",size:0}),n.set("corner",{type:"cut",size:0}),n.layoutParams.set("align",{horizontal:"left",vertical:"top"}),n.layoutParams.set("zIndex",0),n.layoutParams.set("margin",{top:0,right:0,bottom:0,left:0}),(function(e){e.lifecycle.set("onMeasure",(function(t,i){const s=v.desiredSize(t.get("size"),i),o=v.availableSize(s,i),r={width:o.width-2*t.get("border").size,height:o.height-2*t.get("border").size};t.inner.set("desiredSize",s),t.inner.set("availableSize",o),t.inner.set("availableContentSize",r)})),e.lifecycle.set("getChildMaxSize",(function(t,i,s){const o=t.inner.get("availableContentSize"),r=s.layoutParams.get("margin");let l=o.width-r.left-r.right;l<0&&(l=0);let a=o.height-r.top-r.bottom;return a<0&&(a=0),{width:l,height:a}})),e.lifecycle.set("getSize",(function(t,i){const s=v.size(t.inner.get("desiredSize"),i,{width:()=>t.inner.call("getAutoWidth"),height:()=>t.inner.call("getAutoHeight")});return t.inner.set("contentSize",{width:s.width-2*t.get("border").size,height:s.height-2*t.get("border").size}),s})),e.inner.fun("getAutoWidth",(function(t){return t.children.reduce(((i,s)=>{const o=s.layoutParams.get("margin"),r=s.size.width+o.left+o.right;return i>r?i:r}),0)+2*t.get("border").size})),e.inner.fun("getAutoHeight",(function(t){return t.children.reduce(((i,s)=>{const o=s.layoutParams.get("margin"),r=s.size.height+o.top+o.bottom;return i>r?i:r}),0)+2*t.get("border").size}))})(n),(function(e){e.lifecycle.set("onLocate",(function(t,i){t.inner.set("contentCoords",{x:i.x+t.get("border").size,y:i.y+t.get("border").size})})),e.lifecycle.set("getChildCoords",(function(t,i,s){return{x:t.inner.call("getChildX",s),y:t.inner.call("getChildY",s)}})),e.inner.fun("getChildX",(function(t,i){const s=t.inner.get("contentCoords").x,o={start:s,end:s+t.inner.get("contentSize").width},r=i.size.width,l={start:i.layoutParams.get("margin").left,end:i.layoutParams.get("margin").right},a=i.layoutParams.get("align").horizontal;return a==="left"?g.alignStart(o,r,l):a==="middle"?g.alignMiddle(o,r,l):g.alignEnd(o,r,l)})),e.inner.fun("getChildY",(function(t,i){const s=t.inner.get("contentCoords").y,o={start:s,end:s+t.inner.get("contentSize").height},r=i.size.height,l={start:i.layoutParams.get("margin").top,end:i.layoutParams.get("margin").bottom},a=i.layoutParams.get("align").vertical;return a==="top"?g.alignStart(o,r,l):a==="middle"?g.alignMiddle(o,r,l):g.alignEnd(o,r,l)}))})(n),(function(e){e.lifecycle.set("drawItself",(function(t,i){const s=t.coords,o=t.size,r=t.get("background"),l=t.get("border"),a=t.get("corner");T.area(i,s,o,r,l,a)})),e.lifecycle.set("sortChildrenToDraw",(function(t){return[...t.children].sort(((i,s)=>i.layoutParams.get("zIndex")-s.layoutParams.get("zIndex")))}))})(n)}function ve(){const n=m.layout.newType("linear");n.set("size",{width:{unit:"%",value:100},height:{unit:"%",value:100}}),n.set("direction","horizontal"),n.set("alignContent","middle"),n.set("alignItems","middle"),n.set("gap",0),n.set("background","rgba(0,0,0,0)"),n.set("border",{color:"#000",size:0}),n.set("corner",{type:"cut",size:0}),n.layoutParams.set("position",0),n.layoutParams.set("alignSelf","auto"),n.layoutParams.set("margin",{top:0,right:0,bottom:0,left:0}),(function(e){e.lifecycle.set("onStart",(function(t){const i=t.get("direction")==="horizontal"||t.get("direction")==="reverse-horizontal",s=t.get("direction")==="reverse-horizontal"||t.get("direction")==="reverse-vertical",o=[...t.children].sort(((r,l)=>r.layoutParams.get("position")-l.layoutParams.get("position")));s&&o.reverse(),t.inner.set("horizontal",i),t.inner.set("reverse",s),t.inner.set("sortedChildren",o)}))})(n),(function(e){e.lifecycle.set("onMeasure",(function(t,i){const s=v.desiredSize(t.get("size"),i),o=v.availableSize(s,i),r={width:o.width-2*t.get("border").size,height:o.height-2*t.get("border").size};t.inner.set("desiredSize",s),t.inner.set("availableSize",o),t.inner.set("availableContentSize",r)})),e.lifecycle.set("sortChildrenToMeasure",(function(t){return t.inner.get("sortedChildren")})),e.lifecycle.set("getChildMaxSize",(function(t,i,s,o){return{width:t.inner.call("getChildMaxWidth",i,s,o),height:t.inner.call("getChildMaxHeight",i,s,o)}})),e.inner.fun("getChildMaxWidth",(function(t,i,s,o){const r=t.inner.get("horizontal"),l=t.inner.get("availableContentSize"),a=t.get("gap"),c=s.layoutParams.get("margin");if(r){const f=o.reduce(((p,z)=>{const w=z.size.width,b=z.layoutParams.get("margin");return p+w+b.left+b.right+a}),0);let d=l.width-f-c.left-c.right;return d<0&&(d=0),d}let u=l.width-c.left-c.right;return u<0&&(u=0),u})),e.inner.fun("getChildMaxHeight",(function(t,i,s,o){const r=t.inner.get("horizontal"),l=t.inner.get("availableContentSize"),a=t.get("gap"),c=s.layoutParams.get("margin");if(!r){const f=o.reduce(((p,z)=>{const w=z.size.height,b=z.layoutParams.get("margin");return p+w+b.top+b.bottom+a}),0);let d=l.height-f-c.top-c.bottom;return d<0&&(d=0),d}let u=l.height-c.top-c.bottom;return u<0&&(u=0),u})),e.lifecycle.set("getSize",(function(t,i){const s=t.inner.call("getChildrenSize"),o=v.size(t.inner.get("desiredSize"),i,{width:()=>s.width+2*t.get("border").size,height:()=>s.height+2*t.get("border").size}),r={width:o.width-2*t.get("border").size,height:o.height-2*t.get("border").size};return t.inner.set("childrenSize",s),t.inner.set("contentSize",r),o})),e.inner.fun("getChildrenSize",(function(t){return{width:t.inner.call("getChildrenWidth"),height:t.inner.call("getChildrenHeight")}})),e.inner.fun("getChildrenWidth",(function(t){if(t.inner.get("horizontal")){const i=t.get("gap");return t.children.reduce(((s,o,r)=>{const l=o.layoutParams.get("margin"),a=o.size.width;return r===0?s+a+l.left+l.right:s+a+l.left+l.right+i}),0)}return t.children.reduce(((i,s)=>{const o=s.layoutParams.get("margin"),r=s.size.width+o.left+o.right;return i>r?i:r}),0)})),e.inner.fun("getChildrenHeight",(function(t){if(!t.inner.get("horizontal")){const i=t.get("gap");return t.children.reduce(((s,o,r)=>{const l=o.layoutParams.get("margin"),a=o.size.height;return r===0?s+a+l.top+l.bottom:s+a+l.top+l.bottom+i}),0)}return t.children.reduce(((i,s)=>{const o=s.layoutParams.get("margin"),r=s.size.height+o.top+o.bottom;return i>r?i:r}),0)}))})(n),(function(e){e.lifecycle.set("onLocate",(function(t,i){const s={x:i.x+t.get("border").size,y:i.y+t.get("border").size},o=t.inner.call("getChildrenCoord",s);t.inner.set("contentCoords",s),t.inner.set("childrenCoord",o)})),e.inner.fun("getChildrenCoord",(function(t,i){const s=t.inner.get("horizontal"),o=t.inner.get("contentSize"),r=t.inner.get("childrenSize"),l=t.get("alignContent");if(s){const u=r.width,f={start:i.x,end:i.x+o.width};return l==="start"?g.alignStart(f,u):l==="middle"?g.alignMiddle(f,u):g.alignEnd(f,u)}const a=r.height,c={start:i.y,end:i.y+o.height};return l==="start"?g.alignStart(c,a):l==="middle"?g.alignMiddle(c,a):g.alignEnd(c,a)})),e.lifecycle.set("sortChildrenToLocate",(function(t){return t.inner.get("sortedChildren")})),e.lifecycle.set("getChildCoords",(function(t,i,s,o){return{x:t.inner.call("getChildX",s,o),y:t.inner.call("getChildY",s,o)}})),e.inner.fun("getChildX",(function(t,i,s){if(t.inner.get("horizontal")){const p=s.length===0,z=i.layoutParams.get("margin");if(p)return t.inner.get("childrenCoord")+z.left;const w=s[s.length-1],b=t.get("gap");return w.coords.x+w.size.width+w.layoutParams.get("margin").right+b+z.left}const o=t.inner.get("contentCoords"),r=t.inner.get("contentSize"),l={start:o.x,end:o.x+r.width},a=i.size.width,c={start:i.layoutParams.get("margin").left,end:i.layoutParams.get("margin").right},u=t.get("alignItems"),f=i.layoutParams.get("alignSelf"),d=f==="auto"?u:f;return d==="start"?g.alignStart(l,a,c):d==="middle"?g.alignMiddle(l,a,c):g.alignEnd(l,a,c)})),e.inner.fun("getChildY",(function(t,i,s){if(!t.inner.get("horizontal")){const p=s.length===0,z=i.layoutParams.get("margin");if(p)return t.inner.get("childrenCoord")+z.top;const w=s[s.length-1],b=t.get("gap");return w.coords.y+w.size.height+w.layoutParams.get("margin").bottom+b+z.top}const o=t.inner.get("contentCoords"),r=t.inner.get("contentSize"),l={start:o.y,end:o.y+r.height},a=i.size.height,c={start:i.layoutParams.get("margin").top,end:i.layoutParams.get("margin").bottom},u=t.get("alignItems"),f=i.layoutParams.get("alignSelf"),d=f==="auto"?u:f;return d==="start"?g.alignStart(l,a,c):d==="middle"?g.alignMiddle(l,a,c):g.alignEnd(l,a,c)}))})(n),(function(e){e.lifecycle.set("drawItself",(function(t,i){const s=t.coords,o=t.size,r=t.get("background"),l=t.get("border"),a=t.get("corner");T.area(i,s,o,r,l,a)}))})(n)}function xe(){const n=m.layout.newType("grid");n.set("size",{width:{unit:"%",value:100},height:{unit:"%",value:100}}),n.set("dimensions",{columns:[{count:1,unit:"fr",value:1}],rows:[{count:1,unit:"fr",value:1}]}),n.set("gap",{size:{vertical:0,horizontal:0},color:"rgba(0,0,0,0)"}),n.set("alignContent",{vertical:"middle",horizontal:"middle"}),n.set("alignItems",{vertical:"middle",horizontal:"middle"}),n.set("background","rgba(0,0,0,0)"),n.set("border",{color:"#000",size:0}),n.set("corner",{type:"cut",size:0}),n.layoutParams.set("position",{column:0,row:0}),n.layoutParams.set("span",{columns:1,rows:1}),n.layoutParams.set("alignSelf",{vertical:"auto",horizontal:"auto"}),n.layoutParams.set("zIndex",0),n.layoutParams.set("margin",{top:0,right:0,bottom:0,left:0}),(function(e){e.inner.fun("areChildCellsValid",(function(t,i){const s=i.layoutParams.get("position"),o=i.layoutParams.get("span"),r=t.inner.get("numColumns"),l=t.inner.get("numRows");return!(s.column<0||s.row<0||o.columns<1||o.rows<1||s.column+o.columns-1>=r||s.row+o.rows-1>=l)}))})(n),(function(e){e.lifecycle.set("onStart",(function(t){const i=t.get("dimensions"),s=i.columns,o=i.rows,r=s.reduce(((a,c)=>a+c.count),0),l=o.reduce(((a,c)=>a+c.count),0);t.inner.set("numColumns",r),t.inner.set("numRows",l)}))})(n),(function(e){e.lifecycle.set("onMeasure",(function(t,i){const s=v.desiredSize(t.get("size"),i);t.inner.set("desiredSize",s);const o=v.availableSize(s,i);t.inner.set("availableSize",o);const r={width:o.width-2*t.get("border").size,height:o.height-2*t.get("border").size};t.inner.set("availableContentSize",r);const l=t.inner.call("getColumnsWidths");t.inner.set("columnsWidths",l);const a=t.inner.call("getRowsHeights");t.inner.set("rowsHeights",a);const c=t.inner.call("getGridSize");t.inner.set("gridSize",c)})),e.inner.fun("getColumnsWidths",(function(t){const i=t.get("dimensions").columns,s=t.inner.get("availableContentSize").width,o=t.get("gap").size.horizontal;return t.inner.call("getPositionsLengths",i,s,o)})),e.inner.fun("getRowsHeights",(function(t){const i=t.get("dimensions").rows,s=t.inner.get("availableContentSize").height,o=t.get("gap").size.vertical;return t.inner.call("getPositionsLengths",i,s,o)})),e.inner.fun("getPositionsLengths",(function(t,i,s,o){const r=i.reduce(((d,p)=>p.count+d),0);if(r===0)return[];let l=s-o*(r-1);l<0&&(l=0);const a=i.reduce(((d,p)=>p.unit==="px"?d+p.count*p.value:d),0),c=(l-(a<l?a:l))/i.reduce(((d,p)=>p.unit==="fr"?d+p.count*p.value:d),0),u=[];let f=l;for(let d=0;d<i.length;d++){const{count:p,unit:z,value:w}=i[d];for(let b=0;b<p;b++){let I;I=z==="px"?w<f?w:f:c*w,u.push(I),f-=I}}return u})),e.inner.fun("getGridSize",(function(t){const i=t.inner.get("numColumns"),s=t.inner.get("numRows"),o=t.inner.get("columnsWidths"),r=t.inner.get("rowsHeights"),l=o.reduce(((c,u)=>c+u),0),a=r.reduce(((c,u)=>c+u),0);return{width:l+t.get("gap").size.horizontal*(i-1),height:a+t.get("gap").size.vertical*(s-1)}})),e.lifecycle.set("getChildMaxSize",(function(t,i,s){const o=t.get("gap").size,r=t.inner.get("columnsWidths"),l=t.inner.get("rowsHeights"),a=s.layoutParams.get("position"),c=s.layoutParams.get("span"),u=s.layoutParams.get("margin");return t.inner.call("areChildCellsValid",s)?{width:r.slice(a.column,a.column+c.columns).reduce(((f,d)=>f+d+o.horizontal),0)-o.horizontal-(u.left+u.right),height:l.slice(a.row,a.row+c.rows).reduce(((f,d)=>f+d+o.vertical),0)-o.vertical-(u.top+u.bottom)}:{width:0,height:0}})),e.lifecycle.set("getSize",(function(t,i){const s=v.size(t.inner.get("desiredSize"),i,{width:()=>t.inner.get("gridSize").width+2*t.get("border").size,height:()=>t.inner.get("gridSize").height+2*t.get("border").size}),o={width:s.width-2*t.get("border").size,height:s.height-2*t.get("border").size};return t.inner.set("contentSize",o),s}))})(n),(function(e){e.lifecycle.set("onLocate",(function(t,i){const s={x:i.x+t.get("border").size,y:i.y+t.get("border").size};t.inner.set("contentCoords",s);const o=t.inner.call("getGridCoords");t.inner.set("gridCoords",o);const r=t.inner.call("getColumnsCoords");t.inner.set("columnsCoords",r);const l=t.inner.call("getRowsCoords");t.inner.set("rowsCoords",l)})),e.inner.fun("getGridCoords",(function(t){return{x:t.inner.call("getGridX"),y:t.inner.call("getGridY")}})),e.inner.fun("getGridX",(function(t){const i=t.inner.get("contentCoords"),s=t.inner.get("contentSize"),o=t.inner.get("gridSize"),r={start:i.x,end:i.x+s.width},l=o.width,a=t.get("alignContent").horizontal;return a==="left"?g.alignStart(r,l):a==="middle"?g.alignMiddle(r,l):g.alignEnd(r,l)})),e.inner.fun("getGridY",(function(t){const i=t.inner.get("contentCoords"),s=t.inner.get("contentSize"),o=t.inner.get("gridSize"),r={start:i.y,end:i.y+s.height},l=o.height,a=t.get("alignContent").vertical;return a==="top"?g.alignStart(r,l):a==="middle"?g.alignMiddle(r,l):g.alignEnd(r,l)})),e.inner.fun("getColumnsCoords",(function(t){const i=t.inner.get("gridCoords").x,s=t.inner.get("columnsWidths"),o=t.get("gap").size.horizontal;return t.inner.call("getPositionsCoords",i,s,o)})),e.inner.fun("getRowsCoords",(function(t){const i=t.inner.get("gridCoords").y,s=t.inner.get("rowsHeights"),o=t.get("gap").size.vertical;return t.inner.call("getPositionsCoords",i,s,o)})),e.inner.fun("getPositionsCoords",(function(t,i,s,o){const r=[];let l=i;for(const a of s)r.push(l),l+=a+o;return r})),e.lifecycle.set("getChildCoords",(function(t,i,s){return t.inner.call("areChildCellsValid",s)?{x:t.inner.call("getChildX",s),y:t.inner.call("getChildY",s)}:{x:0,y:0}})),e.inner.fun("getChildX",(function(t,i){const s=i.layoutParams.get("position").column,o=i.layoutParams.get("span").columns,r=t.get("gap").size.horizontal,l=t.inner.get("columnsCoords"),a=t.inner.get("columnsWidths"),c=l[s],u={start:c,end:c+(a.slice(s,s+o).reduce(((b,I)=>b+I+r),0)-r)},f=i.size.width,d={start:i.layoutParams.get("margin").left,end:i.layoutParams.get("margin").right},p=t.get("alignItems").horizontal,z=i.layoutParams.get("alignSelf").horizontal,w=z==="auto"?p:z;return w==="left"?g.alignStart(u,f,d):w==="middle"?g.alignMiddle(u,f,d):g.alignEnd(u,f,d)})),e.inner.fun("getChildY",(function(t,i){const s=i.layoutParams.get("position").row,o=i.layoutParams.get("span").rows,r=t.get("gap").size.vertical,l=t.inner.get("rowsCoords"),a=t.inner.get("rowsHeights"),c=l[s],u={start:c,end:c+(a.slice(s,s+o).reduce(((b,I)=>b+I+r),0)-r)},f=i.size.height,d={start:i.layoutParams.get("margin").top,end:i.layoutParams.get("margin").bottom},p=t.get("alignItems").vertical,z=i.layoutParams.get("alignSelf").vertical,w=z==="auto"?p:z;return w==="left"?g.alignStart(u,f,d):w==="middle"?g.alignMiddle(u,f,d):g.alignEnd(u,f,d)}))})(n),(function(e){e.lifecycle.set("drawItself",(function(t,i){t.inner.call("drawArea",i),t.inner.call("drawGaps",i)})),e.inner.fun("drawArea",(function(t,i){const s=t.coords,o=t.size,r=t.get("background"),l=t.get("border"),a=t.get("corner");T.area(i,s,o,r,l,a)})),e.inner.fun("drawGaps",(function(t,i){t.inner.call("drawHorizontalGaps",i),t.inner.call("drawVerticalGaps",i)})),e.inner.fun("drawHorizontalGaps",(function(t,i){const s=t.inner.get("gridCoords"),o=t.inner.get("gridSize"),r=t.get("gap").size,l=t.get("gap").color,a=t.inner.get("rowsCoords");for(let c=1;c<a.length;c++){const u={x:s.x,y:a[c]-r.vertical},f={width:o.width,height:r.vertical};T.rectangle(i,u,f,l)}})),e.inner.fun("drawVerticalGaps",(function(t,i){const s=t.inner.get("gridCoords"),o=t.inner.get("gridSize"),r=t.get("gap").size,l=t.get("gap").color,a=t.inner.get("columnsCoords");for(let c=1;c<a.length;c++){const u={x:a[c]-r.horizontal,y:s.y},f={width:r.horizontal,height:o.height};T.rectangle(i,u,f,l)}})),e.lifecycle.set("sortChildrenToDraw",(function(t){return[...t.children].sort(((i,s)=>i.layoutParams.get("zIndex")-s.layoutParams.get("zIndex")))}))})(n)}function Ce(){const n=m.layout.newType("relative");n.set("size",{width:{unit:"%",value:100},height:{unit:"%",value:100}}),n.set("background","rgba(0,0,0,0)"),n.set("border",{color:"#000",size:0}),n.set("corner",{type:"cut",size:0}),n.layoutParams.set("attachTo",{top:null,right:null,bottom:null,left:null}),n.layoutParams.set("bias",{vertical:50,horizontal:50}),n.layoutParams.set("zIndex",0),n.layoutParams.set("margin",{top:0,right:0,bottom:0,left:0}),(function(e){e.inner.fun("getChildMaxLeft",(function(t,i){const s=i.layoutParams.get("attachTo").left;if(s===null||s==="parent")return t.get("border").size;const{side:o,child:r}=s,l=t.find(r);return o==="left"?t.inner.call("getChildLeft",l):t.inner.call("getChildRight",l)})),e.inner.fun("getChildMaxRight",(function(t,i){const s=i.layoutParams.get("attachTo").right;if(s===null||s==="parent")return t.inner.get("size").width-t.get("border").size;const{side:o,child:r}=s,l=t.find(r);return o==="left"?t.inner.call("getChildLeft",l):t.inner.call("getChildRight",l)})),e.inner.fun("getChildMaxTop",(function(t,i){const s=i.layoutParams.get("attachTo").top;if(s===null||s==="parent")return t.get("border").size;const{side:o,child:r}=s,l=t.find(r);return o==="top"?t.inner.call("getChildTop",l):t.inner.call("getChildBottom",l)})),e.inner.fun("getChildMaxBottom",(function(t,i){const s=i.layoutParams.get("attachTo").bottom;if(s===null||s==="parent")return t.inner.get("size").height-t.get("border").size;const{side:o,child:r}=s,l=t.find(r);return o==="top"?t.inner.call("getChildTop",l):t.inner.call("getChildBottom",l)})),e.inner.fun("getChildLeft",(function(t,i){const s=i.layoutParams.get("attachTo"),o=i.layoutParams.get("margin"),r=t.inner.call("getChildMaxLeft",i),l=t.inner.call("getChildMaxRight",i),a=i.size.width;if(s.right===null)return r+o.left;if(s.left===null)return l-o.right-a;const c={start:r,end:l},u=i.layoutParams.get("bias").horizontal;return t.inner.call("getCoordUsingBias",c,a,u,{start:o.left,end:o.right})})),e.inner.fun("getChildRight",(function(t,i){return t.inner.call("getChildLeft",i)+i.size.width})),e.inner.fun("getChildTop",(function(t,i){const s=i.layoutParams.get("attachTo"),o=i.layoutParams.get("margin"),r=t.inner.call("getChildMaxTop",i),l=t.inner.call("getChildMaxBottom",i),a=i.size.height;if(s.bottom===null)return r+o.top;if(s.top===null)return l-o.bottom-a;const c={start:r,end:l},u=i.layoutParams.get("bias").vertical;return t.inner.call("getCoordUsingBias",c,a,u,{start:o.top,end:o.bottom})})),e.inner.fun("getChildBottom",(function(t,i){return t.inner.call("getChildTop",i)+i.size.height})),e.inner.fun("getCoordUsingBias",(function(t,i,s,o,r){return i.start+(i.end-i.start-(s+r.start+r.end))*(o/100)+r.start}))})(n),(function(e){e.lifecycle.set("onStart",(function(t){const i=t.inner.call("getSortedPositionedChildren"),s=t.children.filter((r=>!i.includes(r))),o=[...i,...s];t.inner.set("sortedChildren",o),t.inner.set("notPositionedChildren",s)})),e.inner.fun("getSortedPositionedChildren",(function(t){const i=[],s=[...t.children];for(;s.length>0;){let o=!1;for(let r=0;r<s.length;r++){const l=s[r];t.inner.call("canPositionChild",i,l)&&(i.push(l),s.splice(r,1),r--,o=!0)}if(!o)break}return i})),e.inner.fun("canPositionChild",(function(t,i,s){const{top:o,bottom:r,right:l,left:a}=s.layoutParams.get("attachTo");for(const c of[o,r,l,a])if(c!==null&&c!=="parent"&&!i.includes(t.find(c.child)))return!1;return!0}))})(n),(function(e){e.lifecycle.set("onMeasure",(function(t,i){const s=v.desiredSize(t.get("size"),i),o=v.availableSize(s,i);t.inner.set("desiredSize",s),t.inner.set("size",o)})),e.lifecycle.set("sortChildrenToMeasure",(function(t){return t.inner.get("sortedChildren")})),e.lifecycle.set("getChildMaxSize",(function(t,i,s){if(t.inner.get("notPositionedChildren").includes(s))return{width:0,height:0};const o=s.layoutParams.get("margin");let r=t.inner.call("getChildMaxRight",s)-t.inner.call("getChildMaxLeft",s)-o.left-o.right;r<0&&(r=0);let l=t.inner.call("getChildMaxBottom",s)-t.inner.call("getChildMaxTop",s)-o.top-o.bottom;return l<0&&(l=0),{width:r,height:l}})),e.lifecycle.set("getSize",(function(t){return t.inner.get("size")}))})(n),(function(e){e.lifecycle.set("sortChildrenToLocate",(function(t){return t.inner.get("sortedChildren")})),e.lifecycle.set("getChildCoords",(function(t,i,s){return t.inner.get("notPositionedChildren").includes(s)?{x:0,y:0}:{x:t.inner.call("getChildLeft",s)+i.x,y:t.inner.call("getChildTop",s)+i.y}}))})(n),(function(e){e.lifecycle.set("drawItself",(function(t,i){const s=t.coords,o=t.size,r=t.get("background"),l=t.get("border"),a=t.get("corner");T.area(i,s,o,r,l,a)})),e.lifecycle.set("sortChildrenToDraw",(function(t){return[...t.children].sort(((i,s)=>i.layoutParams.get("zIndex")-s.layoutParams.get("zIndex")))}))})(n)}function Pe(){(function(){const n=m.composite.newType("textArea");n.set("size",{width:"auto",height:"auto"}),n.set("background","rgba(0,0,0,0)"),n.set("border",{color:"#000",size:0}),n.set("corner",{type:"cut",size:0}),n.set("text","Text"),n.set("font",{size:16,family:"Courier New",weight:400}),n.set("color","#000"),n.set("align",{vertical:"middle",horizontal:"middle"}),n.set("margin",{top:0,right:0,bottom:0,left:0}),n.lifecycle.set("getElement",(function(){const e=m.layout.new("frame","frame"),t=m.view.new("text","text");return e.insert(t),e})),n.lifecycle.set("updateElement",(function(e,t){t.set("size",e.get("size")),t.set("background",e.get("background")),t.set("border",e.get("border")),t.set("corner",e.get("corner"));const i=t.find("text");i.set("text",e.get("text")),i.set("font",e.get("font")),i.set("color",e.get("color")),i.set("align",e.get("align")),i.layoutParams.set("align",e.get("align")),i.layoutParams.set("margin",e.get("margin"))}))})(),(function(){const n=m.composite.newType("imageArea");n.set("size",{width:"auto",height:"auto"}),n.set("background","rgba(0,0,0,0)"),n.set("border",{color:"#000",size:0}),n.set("corner",{type:"cut",size:0}),n.set("imageSize",{width:100,height:100}),n.set("imageSrc",""),n.set("align",{vertical:"middle",horizontal:"middle"}),n.set("margin",{top:0,right:0,bottom:0,left:0}),n.lifecycle.set("getElement",(function(){const e=m.layout.new("frame","frame"),t=m.view.new("image","image");return e.insert(t),e})),n.lifecycle.set("updateElement",(function(e,t){t.set("size",e.get("size")),t.set("background",e.get("background")),t.set("border",e.get("border")),t.set("corner",e.get("corner"));const i=t.find("image");i.set("size",e.get("imageSize")),i.set("src",e.get("imageSrc")),i.layoutParams.set("align",e.get("align")),i.layoutParams.set("margin",e.get("margin"))}))})()}const K=new Map,V=new Map,q=new Map,m={ui:{new:n=>new te(n)},view:{newType(n){const e=new se(n);return K.set(n,e),e},new(n,e){const t=K.get(e);return new pe(n,t)}},layout:{newType(n){const e=new re(n);return V.set(n,e),e},new(n,e){const t=V.get(e);return new X(n,t)}},composite:{newType(n){const e=new ce(n);return q.set(n,e),e},new(n,e){const t=q.get(e);return new we(n,t)}}};ze(),be(),ve(),xe(),Ce(),Pe();const Se=function(n){n.inner.fun("getSize",function(e){const t=e.get("block"),i=e.get("gap"),s=e.call("getNumColumns"),o=e.call("getNumRows"),r=t.size*s+i*(s-1),l=t.size*o+i*(o-1);return{width:r,height:l}})},ke=function(n){n.lifecycle.set("getElement",function(e){return m.layout.new("grid","grid")})},Me=function(n){n.lifecycle.set("updateElement",function(e,t){for(const l of[...t.children])t.remove(l);const i=e.inner.call("getSize");t.set("size",{width:{unit:"px",value:i.width},height:{unit:"px",value:i.height}});const s=e.call("getNumColumns"),o=e.call("getNumRows");t.set("dimensions",{columns:[{count:s,unit:"fr",value:1}],rows:[{count:o,unit:"fr",value:1}]});const r=e.get("gap");t.get("gap").size={horizontal:r,vertical:r},e.inner.call("setupBlocks",t)}),n.inner.fun("setupBlocks",function(e,t){const i=e.get("positions");for(const{x:s,y:o}of i){const r=e.inner.call("buildBlock",{x:s,y:o});e.inner.call("insertBlock",t,r,{x:s,y:o})}}),n.inner.fun("buildBlock",function(e,t){const{x:i,y:s}=t,o=m.view.new(`block-${i},${s}`,"area");o.set("size",{width:{unit:"%",value:100},height:{unit:"%",value:100}});const{background:r,border:l,corner:a}=e.get("block");return o.set("background",r),o.set("border",l),o.set("corner",a),o}),n.inner.fun("insertBlock",function(e,t,i,s){const{x:o,y:r}=s;t.insert(i),i.layoutParams.set("position",{column:o,row:r})})},Te=function(n){Se(n),ke(n),Me(n)},Le=function(n){n.fun("getNumColumns",function(e){return e.get("positions").reduce((i,s)=>i<s.x?s.x:i,0)+1}),n.fun("getNumRows",function(e){return e.get("positions").reduce((i,s)=>i<s.y?s.y:i,0)+1})},Ee=function(){const n=m.composite.newType("piece");n.set("positions",[{x:0,y:0}]),n.set("block",{size:35,background:"#000",border:{color:"#000",size:0},corner:{type:"cut",size:0}}),n.set("gap",0),Te(n),Le(n)},Ie=function(n){n.events.set("leftdown",function(e,t,i){return t.type!=="keydown"?{event:!1}:t.data!=="ArrowLeft"&&t.data!=="a"?{event:!1}:{event:!0}}),n.events.set("leftup",function(e,t,i){return t.type!=="keyup"?{event:!1}:t.data!=="ArrowLeft"&&t.data!=="a"?{event:!1}:{event:!0}}),n.events.set("rightdown",function(e,t,i){return t.type!=="keydown"?{event:!1}:t.data!=="ArrowRight"&&t.data!=="d"?{event:!1}:{event:!0}}),n.events.set("rightup",function(e,t,i){return t.type!=="keyup"?{event:!1}:t.data!=="ArrowRight"&&t.data!=="d"?{event:!1}:{event:!0}}),n.events.set("downdown",function(e,t,i){return t.type!=="keydown"?{event:!1}:t.data!=="ArrowDown"&&t.data!=="s"?{event:!1}:{event:!0}}),n.events.set("downup",function(e,t,i){return t.type!=="keyup"?{event:!1}:t.data!=="ArrowDown"&&t.data!=="s"?{event:!1}:{event:!0}}),n.events.set("updown",function(e,t,i){return t.type!=="keydown"?{event:!1}:t.data!=="ArrowUp"&&t.data!=="w"?{event:!1}:{event:!0}}),n.events.set("upup",function(e,t,i){return t.type!=="keyup"?{event:!1}:t.data!=="ArrowUp"&&t.data!=="w"?{event:!1}:{event:!0}})},Be=function(n){n.fun("insertPiece",function(e,t){e.inner.set("piece",t)}),n.fun("hasPiece",function(e){return e.inner.get("piece")!==null}),n.fun("getPiece",function(e){return e.inner.get("piece")}),n.fun("removePiece",function(e){e.inner.set("piece",null)}),n.fun("insertBlock",function(e,t){e.inner.get("blocks").push(t)}),n.fun("hasBlock",function(e,t){return e.inner.get("blocks").some(s=>s.position.x===t.x&&s.position.y===t.y)}),n.fun("getBlock",function(e,t){return e.inner.get("blocks").find(s=>s.position.x===t.x&&s.position.y===t.y)}),n.fun("removeBlock",function(e,t){const s=e.inner.get("blocks").filter(o=>o.position.x!==t.x||o.position.y!==t.y);e.inner.set("blocks",s)}),n.fun("getBlocks",function(e){return e.inner.get("blocks")}),n.fun("removeBlocks",function(e){e.inner.set("blocks",[])})},Fe=function(n){n.inner.fun("getSize",function(e){const t=e.get("dimensions"),i=e.get("block"),s=e.get("gap"),o=e.get("border"),r=t.columns*i.size+s.size*(t.columns-1)+o.size*2,l=t.rows*i.size+s.size*(t.rows-1)+o.size*2;return{width:r,height:l}})},Re=function(n){n.lifecycle.set("getElement",function(e){return m.layout.new("grid","grid")})},Ae=function(n){n.lifecycle.set("updateElement",function(e,t){t.removeAll();const i=e.inner.call("getSize");t.set("size",{width:{unit:"px",value:i.width},height:{unit:"px",value:i.height}});const s=e.get("dimensions");t.set("dimensions",{columns:[{count:s.columns,unit:"fr",value:1}],rows:[{count:s.rows,unit:"fr",value:1}]});const o=e.get("gap");t.set("gap",{size:{horizontal:o.size,vertical:o.size},color:o.color});const r=e.get("background");t.set("background",r);const l=e.get("border");t.set("border",l);const a=e.get("corner");t.set("corner",a),e.inner.call("setupPieceElement",t),e.inner.call("setupBlockElements",t)}),n.inner.fun("setupPieceElement",function(e,t){if(e.call("hasPiece")){const i=e.inner.call("buildPieceElement");e.inner.call("insertPieceElement",t,i)}}),n.inner.fun("buildPieceElement",function(e,t){const i=m.composite.new("piece","piece"),s=e.get("block"),o=e.get("gap"),r=e.inner.get("piece");return i.set("positions",r.piece.positions),i.set("block",{size:s.size,background:r.piece.background,border:{size:s.border,color:r.piece.border},corner:{type:"round",size:s.corner}}),i.set("gap",o.size),i}),n.inner.fun("insertPieceElement",function(e,t,i){const s=e.inner.get("piece"),{x:o,y:r}=s.position,{columns:l,rows:a}=s.piece.span;t.insert(i),i.layoutParams.set("position",{column:o,row:r}),i.layoutParams.set("span",{columns:l,rows:a})}),n.inner.fun("setupBlockElements",function(e,t){const i=e.inner.get("blocks");for(const[s,o]of i.entries()){const r=e.inner.call("buildBlockElement",s,o);e.inner.call("insertBlockElement",t,r,o.position)}}),n.inner.fun("buildBlockElement",function(e,t,i){const s=m.view.new(`block-${t}`,"area"),o=e.get("block");return s.set("background",i.block.background),s.set("size",{width:{unit:"px",value:o.size},height:{unit:"px",value:o.size}}),s.set("border",{size:o.border,color:i.block.border}),s.set("corner",{type:"round",size:o.corner}),s}),n.inner.fun("insertBlockElement",function(e,t,i,s){const{x:o,y:r}=s;t.insert(i),i.layoutParams.set("position",{column:o,row:r})})},De=function(n){Fe(n),Re(n),Ae(n)},Ne=function(){const n=m.composite.newType("tetris");n.set("dimensions",{columns:10,rows:20}),n.set("block",{size:35,border:0,corner:0}),n.set("gap",{size:1,color:"#fff"}),n.set("background","#f0f0f0"),n.set("border",{color:"#000",size:0}),n.set("corner",{type:"cut",size:0}),n.inner.set("piece",null),n.inner.set("blocks",[]),De(n),Be(n),Ie(n)},$e=function(){Ee(),Ne()},h={dimensions:{columns:10,rows:20},delays:{down:{normal:400,fast:100},horizontal:100},styles:{area:{background:"#F5F5F5",border:{size:5,color:"#E0E0E0"},corner:{type:"round",size:10}},block:{size:25,border:5,corner:5,gap:0},button:{color:"#626262",background:"#F5F5F5",border:{size:5,color:"#E0E0E0"},corner:{type:"round",size:10},font:{family:"Raleway, sans-serif",size:16,weight:600},mousedown:{background:"#E0E0E0"}},text:{color:"#626262",border:{size:5,color:"#E0E0E0"},corner:{type:"round",size:10},font:{family:"Raleway, sans-serif",size:16,weight:600}}}};let A,P,B,S,x,L,k;const _e=function(){const n=m.ui.new("#ui");return A=m.layout.new("root","frame"),n.start(A),P=m.layout.new("game","linear"),P.set("size",{width:"auto",height:"auto"}),P.set("direction","horizontal"),P.set("alignItems","start"),P.set("gap",50),A.insert(P),P.layoutParams.set("align",{horizontal:"middle",vertical:"middle"}),B=m.layout.new("aside","linear"),B.set("size",{width:{unit:"px",value:150},height:"auto"}),B.set("direction","vertical"),B.set("gap",20),P.insert(B),S=m.composite.new("scoreText","textArea"),S.set("size",{width:{unit:"%",value:100},height:{unit:"px",value:50}}),S.set("text","Score: 0"),S.set("border",h.styles.text.border),S.set("color",h.styles.text.color),S.set("font",h.styles.text.font),S.set("corner",h.styles.text.corner),B.insert(S),x=m.composite.new("playButton","textArea"),x.set("size",{width:{unit:"%",value:100},height:{unit:"px",value:50}}),x.set("text","Play"),x.set("background",h.styles.button.background),x.set("color",h.styles.button.color),x.set("font",h.styles.button.font),x.set("border",h.styles.button.border),x.set("corner",h.styles.button.corner),x.listeners.add("mousedown",function(){x.set("background",h.styles.button.mousedown.background)}),A.listeners.add("mouseup",function(e){x.set("background",h.styles.button.background)}),B.insert(x),L=m.composite.new("tetris","tetris"),L.set("dimensions",h.dimensions),L.set("block",{size:h.styles.block.size,border:h.styles.block.border,corner:h.styles.block.corner}),L.set("gap",{size:h.styles.block.gap,color:"rgba(0,0,0,0)"}),L.set("background",h.styles.area.background),L.set("border",h.styles.area.border),L.set("corner",h.styles.area.corner),P.insert(L),k=m.layout.new("pieceContainer","frame"),k.set("size",{width:{unit:"px",value:150},height:{unit:"px",value:150}}),k.set("background",h.styles.area.background),k.set("border",h.styles.area.border),k.set("corner",h.styles.area.corner),P.insert(k),A},Ge=function(n){He(),Ue(Oe(n))},He=function(){let n=k.find("piece");n&&k.remove(n)},Oe=function(n){const e=m.composite.new("piece","piece");return e.set("positions",n.positions),e.set("block",{size:h.styles.block.size,background:n.background,border:{size:h.styles.block.border,color:n.border},corner:{type:"round",size:h.styles.block.corner}}),e.set("gap",h.styles.block.gap),e},Ue=function(n){k.insert(n),n.layoutParams.set("align",{horizontal:"middle",vertical:"middle"})},We=function(n){S.set("text","Score: "+n)};class Xe{constructor(e,t){this.background=e,this.border=t}}const Ye=function(n,e){const t=[];for(let i=n;i<n+e;i++)t.push(i);return t},j=function(n){const e=Math.floor(Math.random()*n.length),t=n[e];return{index:e,value:t}},Ke=function(n,e){return Math.floor(Math.random()*(n+e+1)+n)},Y=function(){return new Date().getTime()};class F{constructor(e,t,i){this.positions=e,this.background=t,this.border=i}get span(){return{columns:this.numColumns,rows:this.numRows}}get numColumns(){return this.positions.reduce((e,t)=>e<t.x?t.x:e,0)+1}get numRows(){return this.positions.reduce((e,t)=>e<t.y?t.y:e,0)+1}rotate(){const e=this.positions,t=this.numColumns-1,i=[];for(const{x:s,y:o}of e)i.push({x:o,y:t-s});this.positions=i}}const Ve=()=>new F([{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:3,y:0}],"#277da1","#237191"),qe=()=>new F([{x:0,y:0},{x:0,y:1},{x:1,y:1},{x:2,y:1}],"#f94144","#e03b3d"),Je=()=>new F([{x:2,y:0},{x:0,y:1},{x:1,y:1},{x:2,y:1}],"#577590","#4e6982"),je=()=>new F([{x:0,y:0},{x:0,y:1},{x:1,y:0},{x:1,y:1}],"#f3722c","#db6728"),Ze=()=>new F([{x:0,y:1},{x:1,y:1},{x:1,y:0},{x:2,y:0}],"#4d908e","#458280"),Qe=()=>new F([{x:0,y:1},{x:1,y:1},{x:1,y:0},{x:2,y:1}],"#f8961e","#df871b"),et=()=>new F([{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:2,y:1}],"#f9c74f","#e0b347"),tt=[Ve,qe,Je,je,Ze,Qe,et];$e();const Z=_e(),y=Z.find("tetris"),nt=Z.find("playButton");let G,H,E,M,C,$;const Q=function(){it(),st(),ot(),cancelAnimationFrame(G);const n=()=>{G=requestAnimationFrame(n),rt()};n(),kt()},it=function(){H=0,E={down:null,horizontal:null},M={down:h.delays.down.normal,horizontal:h.delays.horizontal},C={left:!1,right:!1,rotate:!1},$=ee()},st=function(){y.call("removePiece"),y.call("removeBlocks")},ot=function(){y.listeners.removeAll("leftdown"),y.listeners.removeAll("leftup"),y.listeners.removeAll("rightdown"),y.listeners.removeAll("rightup"),y.listeners.removeAll("downdown"),y.listeners.removeAll("downup"),y.listeners.removeAll("updown")},ee=function(){const n=j(tt).value();for(let e=0;e<Ke(0,3);e++)n.rotate();return n},rt=function(){if(lt())at()&&(ct()?ut():dt()&&ht()),gt()&&ft(),mt()&&(yt()||pt());else if(wt($))$=ee(),Ge($);else return vt();const n=xt();H+=St(n),We(H)},lt=function(){return y.call("hasPiece")},at=function(){const n=Y();return E.horizontal!==null&&n-E.horizontal<M.horizontal?!1:(E.horizontal=n,!0)},ct=function(){return C.left&&!C.right},ut=function(){M.horizontal=h.delays.horizontal;const n=y.call("getPiece");n.position.x-=1,!D(n)&&(n.position.x+=1)},dt=function(){return C.right&&!C.left},ht=function(){M.horizontal=h.delays.horizontal;const n=y.call("getPiece");n.position.x+=1,!D(n)&&(n.position.x-=1)},gt=function(){return C.rotate},ft=function(){C.rotate=!1;const n=y.call("getPiece");if(n.piece.rotate(),!D(n))for(let e=0;e<3;e++)n.piece.rotate()},mt=function(){const n=Y();return E.down!==null&&n-E.down<M.down?!1:(E.down=n,!0)},yt=function(){const n=y.call("getPiece");return n.position.y+=1,D(n)?!0:(n.position.y-=1,!1)},pt=function(){const n=y.call("getPiece");y.call("removePiece");for(const e of n.piece.positions){const t=n.position.x+e.x,i=n.position.y+e.y,s=new Xe(n.piece.background,n.piece.border);y.call("insertBlock",{position:{x:t,y:i},block:s})}},wt=function(n){const e=Ye(0,h.dimensions.columns);do{const{index:t,value:i}=j(e),s={x:i,y:0};if(D({position:s,piece:n}))return y.call("insertPiece",{position:s,piece:n}),E.down=Y(),!0;e.splice(t,1)}while(e.length>0);return!1},D=function(n){return!(!zt(n)||bt(n))},zt=function(n){return!(n.position.x<0||n.position.y<0||n.position.x+n.piece.span.columns>h.dimensions.columns||n.position.y+n.piece.span.rows>h.dimensions.rows)},bt=function(n){const e=y.call("getBlocks");for(const t of e)if(n.piece.positions.find(({x:s,y:o})=>n.position.x+s===t.position.x&&n.position.y+o===t.position.y))return!0;return!1},vt=function(){cancelAnimationFrame(G)},xt=function(){let n=0;for(let e=h.dimensions.rows-1;e>=0;e--)Ct(e)&&(Pt(e),n++,e++);return n},Ct=function(n){const e=y.call("getBlocks");for(let t=0;t<10;t++)if(!e.some(({position:{x:s,y:o}})=>s===t&&o===n))return!1;return!0},Pt=function(n){for(let e=0;e<10;e++)y.call("removeBlock",{x:e,y:n});for(let e=n-1;e>=0;e--)for(let t=0;t<10;t++){const i={x:t,y:e},s=y.call("getBlock",i);s&&(s.position.y+=1)}},St=function(n){return n===0?0:n===1?40:n===2?100:n===3?300:1200},kt=function(){y.listeners.add("leftdown",()=>{M.horizontal=0,C.left=!0}),y.listeners.add("leftup",()=>C.left=!1),y.listeners.add("rightdown",()=>{M.horizontal=0,C.right=!0}),y.listeners.add("rightup",()=>C.right=!1),y.listeners.add("downdown",()=>{M.down=h.delays.down.fast}),y.listeners.add("downup",()=>{M.down=h.delays.down.normal}),y.listeners.add("updown",()=>C.rotate=!0)};Q();nt.listeners.add("click",()=>Q());
